<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Products - Bloomify Malaysia</title>
    
    <!-- 1. Load React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 2. Load Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 3. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Custom Animation Styles (Same as Homepage) */
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob {
            animation: blob 7s infinite;
        }
        .animation-delay-2000 {
            animation-delay: 2s;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        
        // --- ICONS ---
        const Icon = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );
        
        const ShoppingBag = (props) => <Icon {...props}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></Icon>;
        const Search = (props) => <Icon {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></Icon>;
        const Menu = (props) => <Icon {...props}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></Icon>;
        const User = (props) => <Icon {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>;
        const Star = (props) => <Icon {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></Icon>;
        const Heart = (props) => <Icon {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></Icon>;
        const X = (props) => <Icon {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></Icon>;


        // --- MAIN APP COMPONENT ---
        const App = () => {
            // derive cart count from localStorage if available
            const loadCart = () => {
                try {
                    const raw = localStorage.getItem('bloomifyCart');
                    return raw ? JSON.parse(raw) : [];
                } catch (e) { return []; }
            };

            // State definitions
            const [cartCount, setCartCount] = React.useState(() => loadCart().reduce((s,i)=>s+(i.quantity||1),0));
            const [isMenuOpen, setIsMenuOpen] = React.useState(false);
            const [sortBy, setSortBy] = React.useState('Recommended');
            const [toast, setToast] = React.useState('');
            
            // New state for category filtering, defaulting to 'All'
            const [selectedCategory, setSelectedCategory] = React.useState('All');


            // read query param q and keep local search state
            const params = new URLSearchParams(window.location.search);
            const initialQuery = params.get('q') || '';
            const [searchQuery, setSearchQuery] = React.useState(initialQuery);

            const handleSearchOnPage = () => {
                const q = (searchQuery || '').trim();
                const url = new URL(window.location.href);
                if (q) {
                    url.searchParams.set('q', q);
                } else {
                    url.searchParams.delete('q');
                }
                window.history.replaceState({}, '', url.toString());
                // Rerun filtering by changing searchQuery state (although not strictly necessary since
                // we're using searchQuery as a controlled component, this is good practice if
                // we needed to trigger a server-side search fetch in a real app)
                // For this mock, we rely on the searchQuery state update.
            };

            // --- PRODUCT DATA ---
            const products = [
                { id: 1, brand: "COSRX", name: "Advanced Snail 96 Mucin Power Essence", price: 48.00, originalPrice: 62.00, rating: 4.8, reviews: 1240, image: "COSRX%20Advanced%20Snail%2092%20All%20In%20One%20Cream%20100mL%20_%20OLIVE%20YOUNG%20Global.webp", tag: "Best Seller", category: "Skincare" },
                { id: 2, brand: "Hince", name: "Hince Cover Master Pink Cushion", price: 110.20, originalPrice: 139.90, rating: 4.9, reviews: 967, image: "08b4ee01-fed2-4a17-a318-02e7fd529075.webp", tag: "Trending", category: "Makeup" },
                { id: 3, brand: "Innisfree", name: "Retinol Cica Repair Ampoule 30ml", price: 130.20, originalPrice: 156.00, rating: 4.7, reviews: 1200, image: "ac336422-1ce1-48b9-b78c-ee2e09fd5e89.webp", tag: "Staff Pick", category: "Skincare" },
                { id: 4, brand: "Clio", name: "Kill Cover Mesh Glow Cushion", price: 131.40, originalPrice: 155.93, rating: 4.9, reviews: 540, image: "03d04c7c-4b79-4fc3-bb2e-4dfa30a356b9.webp", tag: "Trending", category: "Makeup" },
                { id: 5, brand: "Beauty of Joseon", name: "Glow Serum: Propolis + Niacinamide", price: 59.00, originalPrice: 68.70, rating: 4.4, reviews: 1900, image: "d0f29dc9-1d01-46d6-9de9-9008a14a41d6.webp", tag: "Staff Pick", category: "Skincare" },
                { id: 6, brand: "Mediheal", name: "Mediheal Cotton Facial Toner Pad", price: 103.99, originalPrice: 149.90, rating: 4.5, reviews: 1067, image: "MEDIHEAL%20Madecassoside%20Cotton%20Facial%20Pads%20-%20Toner%20Pads%20with%20Centella%20Asiatica%20to%20Improve%20Uneven%20Skin%20Tone%20-%20Vegan%20Face%20Gauze%20Pads,%20100%20Pads.webp", tag: "Sale", category: "Skincare" },
                { id: 7, brand: "SKIN1004", name: "Madagascar Centella Ampoule", price: 33.40, originalPrice: 41.70, rating: 4.8, reviews: 2125, image: "download%20(73).webp", tag: "Best Seller", category: "Skincare" },
                { id: 8, brand: "Peripera", name: "Ink Mood Glowy Tint", price: 42.10, originalPrice: 45.90, rating: 4.5, reviews: 890, image: "ef81a3b2-2c0b-4534-8e1b-618389cf11f8.webp", tag: "Sale", category: "Makeup" },
                { id: 9, brand: "Torriden", name: "Dive-In Low Molecule Hyaluronic Acid Serum", price: 85.40, originalPrice: 89.00, rating: 4.6, reviews: 102, image: "1934b000-d11f-4464-977d-6aaa97d1a9c9.webp", tag: "New Arrival", category: "Skincare" },
                { id: 10, brand: "Axis-Y", name: "Axis-Y Dark Spot Correcting Glow Serum", price: 65.00, originalPrice: 75.00, rating: 4.6, reviews: 143, image: "DarkSpotCorrectingGlowSerum_2.webp", tag: "New Arrival", category: "Skincare" },
                { id: 11, brand: "Dr. Jart", name: "Cicapair Sensitive Skin Serum", price: 176.00, originalPrice: 182.00, rating: 4.7, reviews: 167, image: "dj_sku_H7NC01_1000x1000_0.webp", tag: "New Arrival", category: "Skincare" },
                { id: 12, brand: "Some By Mi", name: "AHA-BHA-PHA 30 Days Miracle Acne Body Cleanser", price: 54.70, originalPrice: 88.00, rating: 4.5, reviews: 152, image: "bfc799ef-9b34-4af1-8bdf-0d63b7d41453.webp", tag: "Sale", category: "Body" },
                { id: 13, brand: "Atopalm", name: "Atopalm Top To Toe Wash", price: 75.90, originalPrice: 101.90, rating: 4.8, reviews: 67, image: "images.webp", tag: "New Arrival", category: "Body" },
                { id: 14, brand: "ILLIYOON", name: "MD Red Itch Intensive Moisturizing Wash", price: 51.10, originalPrice: 87.40, rating: 4.5, reviews: 58, image: "b4771b8f-b331-49f6-a98b-38742c0f649d.webp", tag: "New Arrival", category: "Body" },
                { id: 15, brand: "Some By Mi", name: "AHA-BHA-PHA 30 Days Miracle Serum", price: 77.30, originalPrice: 89.00, rating: 4.5, reviews: 74, image: "0719-SOME-BY-MI-AHA-BHA-PHA-30-Days-Miracle-Serum-50ml_400x.webp", tag: "New Arrival", category: "Skincare" }
            ];

            const categories = ["All", "Skincare", "Makeup", "Body"];

            // Filter products by search query AND selected category
            const filteredProducts = products.filter(p => {
                const q = searchQuery.toLowerCase().trim();
                
                // 1. Search Query Match
                const queryMatch = !q || (p.name + ' ' + p.brand + ' ' + p.tag + ' ' + p.category).toLowerCase().includes(q);

                // 2. Category Match
                const categoryMatch = selectedCategory === 'All' || p.category === selectedCategory;

                return queryMatch && categoryMatch;
            });

            // Sort the filtered products according to the selected sort option
            const sortedProducts = React.useMemo(() => {
                const arr = [...filteredProducts];
                if (sortBy === 'Price: Low to High') {
                    arr.sort((a,b) => (a.price || 0) - (b.price || 0));
                } else if (sortBy === 'Price: High to Low') {
                    arr.sort((a,b) => (b.price || 0) - (a.price || 0));
                } else if (sortBy === 'Top Rated') {
                    arr.sort((a,b) => (b.rating || 0) - (a.rating || 0));
                }
                return arr;
            }, [filteredProducts, sortBy]);

            // --- CART HELPERS (shared with index & shopping cart) ---
            const saveCart = (cart) => {
                try {
                    localStorage.setItem('bloomifyCart', JSON.stringify(cart));
                } catch (e) { console.error('saveCart error', e); }
            };

            const addToCart = (product) => {
                try {
                    const raw = localStorage.getItem('bloomifyCart');
                    const cart = raw ? JSON.parse(raw) : [];
                    const existing = cart.find(i => i.id === product.id);
                    if (existing) {
                        existing.quantity = (existing.quantity || 1) + 1;
                    } else {
                        // store a minimal product copy to localStorage
                        cart.push({ id: product.id, name: product.name, brand: product.brand, price: product.price, image: product.image, quantity: 1 });
                    }
                    saveCart(cart);
                    const total = cart.reduce((s,i)=>s+(i.quantity||1),0);
                    setCartCount(total);
                    setToast('Added to cart');
                    setTimeout(() => setToast(''), 1800);
                } catch (e) {
                    console.error('addToCart error', e);
                    // Using console.log instead of alert for error messaging
                    console.log('Error: Could not add to cart. Please check console for details.');
                }
            };

            return (
                <div className="font-sans text-gray-800 bg-white min-h-screen">
                
                {/* Navbar (Same as Index) */}
                <nav className="sticky top-0 z-50 bg-white border-b border-gray-100 shadow-sm">
                    <div className="max-w-6xl mx-auto px-4">
                    <div className="flex justify-between items-center h-16">
                        <button className="md:hidden p-2" onClick={() => setIsMenuOpen(!isMenuOpen)}>
                            {isMenuOpen ? <X size={24} /> : <Menu size={24} />}
                        </button>

                        {/* Link back to Home */}
                        <a href="index.html" className="text-2xl font-bold text-pink-400 tracking-tight flex-shrink-0 cursor-pointer hover:text-pink-500 transition">
                            BLOOMIFY
                        </a>

                        <div className="hidden md:flex flex-1 max-w-lg mx-8 relative">
                        <input 
                            type="text" 
                            value={searchQuery} 
                            onChange={(e)=>{ setSearchQuery(e.target.value); }} 
                            onKeyDown={(e)=>{ if (e.key === 'Enter') handleSearchOnPage(); }} 
                            className="w-full bg-gray-50 border border-gray-200 rounded-full py-2 pl-4 pr-10 focus:outline-none focus:border-teal-500 transition-all" 
                            placeholder="Search products..."
                        />
                        <button onClick={() => handleSearchOnPage()} className="absolute right-3 top-2.5 text-gray-400 hover:text-pink-600">
                            <Search size={20} />
                        </button>
                        </div>

                        <div className="flex items-center gap-4">
                        <a href="login_signup.html" className="hidden md:flex items-center gap-1 text-gray-600 hover:text-pink-600 text-sm font-medium">
                            <User size={20} />
                            <span>Login</span>
                        </a>
                        <a href="shopping_cart.html" className="relative text-gray-600 hover:text-pink-600">
                            <ShoppingBag size={24} />
                            {cartCount > 0 && (
                            <span className="absolute -top-1 -right-1 bg-rose-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center">
                                {cartCount}
                            </span>
                            )}
                        </a>
                        </div>
                    </div>
                    </div>

                    {/* Mobile Menu & Category Links (Updated for Clickability) */}
                    <div className={`md:block ${isMenuOpen ? 'block' : 'hidden'} border-t border-gray-100`}>
                    <div className="max-w-6xl mx-auto px-4">
                        <ul className="flex flex-col md:flex-row md:gap-8 text-sm font-medium text-gray-600 py-2">
                        {categories.map(cat => (
                            <li key={cat}>
                            <a 
                                href="#" 
                                onClick={(e) => { 
                                    e.preventDefault(); 
                                    setSelectedCategory(cat); 
                                    if (isMenuOpen) setIsMenuOpen(false); // Close menu on mobile after selection
                                }}
                                className={`block py-2 px-2 hover:text-pink-800 transition-colors ${cat === selectedCategory ? 'text-pink-500 font-bold border-b-2 border-pink-500 md:border-b-0 md:text-pink-800' : ''}`}
                            >
                                {cat}
                            </a>
                            </li>
                        ))}
                        </ul>
                    </div>
                    </div>
                </nav>

                {/* Compact Hero / Breadcrumb Section (Updated for Category) */}
                <div className="bg-pink-50 py-8 border-b border-pink-100">
                    <div className="max-w-6xl mx-auto px-4">
                        <div className="text-sm text-gray-500 mb-2">
                        <span>Home / Search / </span>
                        {searchQuery && <span className="text-gray-900 font-medium">{searchQuery} / </span>}
                        <span className="text-pink-500 font-bold">{selectedCategory}</span>
                        </div>
                        <h1 className="text-3xl md:text-4xl font-bold text-gray-900 mb-2">
                            {searchQuery ? `Results for "${searchQuery}" in ${selectedCategory}` : `${selectedCategory} Products`}
                        </h1>
                        <p className="text-gray-600 max-w-2xl">
                            Search and explore our {selectedCategory.toLowerCase()} products. Find everything to make your dream skincare comes true!
                        </p>
                    </div>
                </div>

                {/* Toast */}
                {toast && (
                    <div className="fixed right-4 top-24 bg-black text-white px-4 py-2 rounded shadow-lg z-50 transition-opacity duration-300">
                        {toast}
                    </div>
                )}

                {/* Main Content Area */}
                <main className="max-w-6xl mx-auto px-4 py-8">
                    
                    {/* Controls Bar */}
                    <div className="flex flex-col md:flex-row justify-between items-center mb-6 pb-4 border-b border-gray-100 gap-4">
                        <div className="text-gray-500 font-medium">
                            Showing <span className="text-gray-900 font-bold">{sortedProducts.length}</span>
                            {searchQuery && <span> results for "<span className="font-bold text-gray-900">{searchQuery}</span>"</span>}
                            <span> in </span>
                            <span className="font-bold text-pink-500">{selectedCategory}</span>
                        </div>

                        <div className="flex gap-3 w-full md:w-auto">
                            <select 
                                className="flex-1 md:flex-none px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium focus:outline-none focus:border-pink-500 bg-white"
                                value={sortBy}
                                onChange={(e) => setSortBy(e.target.value)}
                            >
                                <option>Recommended</option>
                                <option>Price: Low to High</option>
                                <option>Price: High to Low</option>
                                <option>Top Rated</option>
                            </select>
                        </div>
                    </div>

                    {/* Product Grid */}
                    {sortedProducts.length > 0 ? (
                    <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    {sortedProducts.map((product) => (
                        <a key={product.id} href={`product_detail.html?id=${product.id}`} className="group bg-white rounded-xl border border-gray-100 hover:border-pink-200 hover:shadow-lg transition-all duration-300 flex flex-col overflow-hidden relative no-underline text-inherit">
                        
                        {/* Badge */}
                        <div className="absolute top-3 left-3 z-10">
                            <span className="bg-white/90 backdrop-blur text-teal-800 text-[10px] font-bold px-2 py-1 rounded shadow-sm border border-teal-50">
                            {product.tag}
                            </span>
                        </div>

                        {/* Like Button */}
                        <button 
                            onClick={(e) => { e.preventDefault(); console.log(`Liked product ${product.id}`); }}
                            className="absolute top-3 right-3 z-10 p-2 bg-white/50 hover:bg-white rounded-full text-gray-400 hover:text-rose-500 transition-colors">
                            <Heart size={16} />
                        </button>

                        {/* Image */}
                        <div className="aspect-[4/5] overflow-hidden bg-gray-100 relative">
                            <img 
                            src={product.image} 
                            alt={product.name} 
                            // Fallback in case placeholder image link is broken
                            onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/100x125/e2e8f0/94a3b8?text=Product+Image+Missing"; }}
                            className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                            />
                            
                            {/* Quick Add Overlay */}
                            <div className="absolute bottom-0 left-0 right-0 p-4 translate-y-full group-hover:translate-y-0 transition-transform duration-300 hidden md:block">
                            <button 
                                onClick={(e) => { e.preventDefault(); addToCart(product); }}
                                className="w-full bg-pink-400 text-white py-3 rounded-lg font-medium shadow-lg hover:bg-pink-800 flex items-center justify-center gap-2"
                            >
                                <ShoppingBag size={18} /> Add to Cart
                            </button>
                            </div>
                        </div>

                        {/* Details */}
                        <div className="p-4 flex flex-col flex-1">
                            <div className="text-xs text-gray-500 font-bold mb-1 uppercase tracking-wide">{product.brand}</div>
                            <h3 className="font-medium text-gray-900 leading-snug mb-2 line-clamp-2 hover:text-teal-700 cursor-pointer">
                            {product.name}
                            </h3>
                            
                            <div className="mt-auto">
                            <div className="flex items-center gap-1 mb-2">
                                <Star size={14} className="fill-yellow-400 text-yellow-400" />
                                <span className="text-xs font-bold text-gray-700">{product.rating}</span>
                                <span className="text-xs text-gray-400">({product.reviews})</span>
                            </div>
                            
                            <div className="flex items-baseline gap-2">
                                <span className="text-lg font-bold text-gray-900">RM {product.price.toFixed(2)}</span>
                                {product.originalPrice > product.price && (
                                <span className="text-sm text-gray-400 line-through">RM {product.originalPrice.toFixed(2)}</span>
                                )}
                                {product.originalPrice > product.price && (
                                <span className="text-xs font-bold text-rose-500">
                                    {Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100)}% OFF
                                </span>
                                )}
                            </div>
                            </div>

                            {/* Mobile Add Button */}
                            <button 
                            onClick={(e) => { e.preventDefault(); addToCart(product); }}
                            className="mt-3 w-full md:hidden border border-teal-600 text-teal-700 py-2 rounded-lg text-sm font-medium active:bg-teal-50"
                            >
                            Add to Cart
                            </button>
                        </div>
                        </a>
                    ))}
                    </div>
                    ) : (
                        <div className="text-center py-20 bg-gray-50 rounded-xl border border-gray-200">
                            <Search size={48} className="mx-auto text-gray-300 mb-4" />
                            <h2 className="text-2xl font-semibold text-gray-700">No products found</h2>
                            <p className="text-gray-500 mt-2">Try adjusting your filters or search query.</p>
                        </div>
                    )}
                </main>

                {/* Reopen Promo button (opens homepage with promo anchor) */}
                <button onClick={() => window.open('index.html#promo','_blank')} className="fixed left-4 bottom-4 bg-pink-500 text-white px-3 py-2 rounded-full shadow-lg z-50 hover:bg-pink-600 transition">
                    Reopen Promo
                </button>

                {/* Footer (Consistent with Homepage) */}
                <footer className="bg-gray-900 text-white py-12 border-t border-gray-800">
                    <div className="max-w-6xl mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div>
                        <div className="text-2xl font-bold mb-4">BLOOMIFY</div>
                        <p className="text-gray-400 text-sm">
                        Your daily dose of beauty. Curated K-Beauty brands and health supplements delivered to your door.
                        </p>
                    </div>
                    <div>
                        <h4 className="font-bold mb-4 text-gray-200">Customer Service</h4>
                        <ul className="space-y-2 text-sm text-gray-400">
                        <li className="hover:text-white cursor-pointer">Help Center</li>
                        <li className="hover:text-white cursor-pointer">Shipping & Returns</li>
                        </ul>
                    </div>
                    <div>
                        <h4 className="font-bold mb-4 text-gray-200">About Us</h4>
                        <ul className="space-y-2 text-sm text-gray-400">
                        <li className="hover:text-white cursor-pointer">Our Story</li>
                        <li className="hover:text-white cursor-pointer">Sustainability</li>
                        </ul>
                    </div>
                    <div>
                        <h4 className="font-bold mb-4 text-gray-200">Stay in the loop</h4>
                        <div className="flex gap-2">
                        <input type="email" placeholder="Enter email" className="bg-gray-800 border-none text-white text-sm p-2 rounded w-full focus:ring-2 focus:ring-pink-500 focus:outline-none" />
                        <button className="bg-pink-500 px-4 rounded text-sm font-medium hover:bg-pink-400 transition">Sub</button>
                        </div>
                    </div>
                    </div>
                    <div className="max-w-6xl mx-auto px-4 mt-12 pt-8 border-t border-gray-800 text-center text-xs text-gray-500">
                    Â© 2025 Bloomify. All rights reserved. Just a mockup assignment for MKT667.
                    </div>
                </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
